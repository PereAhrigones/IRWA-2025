<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    {# Using Bootstrap v4.6.1 #}
    <link rel="stylesheet" href="{{ url_for('static',filename='styles/bootstrap.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static',filename='styles/custom.css') }}">
    <title>{% block page_title %}{% endblock %} - IRWA Search Engine</title>
    {% block header %}{% endblock %}
</head>
<body>
<div><a href="/stats" >Stats</a></div>
<div><a href="/dashboard" >Dashboard</a></div>
<div class="container">
    <div class='header text-center'>
        <div class="header-layout">
            <a href="/" class="logo-container">
                <img src="{{ url_for('static', filename='logo.png') }}" width="100" alt="UPF logo"/>
            </a>
            <span class="header-title"> IRWA Search Engine </span>
        </div>
    </div>
    <hr>
    <div class='content'>
        {% block content %}
            base
        {% endblock %}
    </div>
    <hr>
    <div class='centered'>Information Retrieval and Web Analytics</div>
</div>

<!-- Global click heatmap tracking -->
<script>
    (function(){
        // Detect current page
        function getCurrentPage(){
            const path = window.location.pathname;
            if (path.includes('results')) return 'results';
            if (path.includes('doc_details')) return 'doc_details';
            if (path.includes('dashboard')) return 'dashboard';
            if (path.includes('stats')) return 'stats';
            return 'other';
        }

        // Track all clicks on the page
        document.addEventListener('click', function(e){
            try {
                // Normalize coordinates to 0-1 range
                const x = e.clientX / window.innerWidth;
                const y = e.clientY / window.innerHeight;
                const page = getCurrentPage();

                const payload = JSON.stringify({
                    x: x,
                    y: y,
                    page: page
                });

                // Use sendBeacon for reliability (no need to wait for response)
                if (navigator.sendBeacon){
                    const blob = new Blob([payload], {type: 'application/json'});
                    navigator.sendBeacon('/analytics/record_click', blob);
                }
            } catch(e){
                console.warn('Click tracking failed', e);
            }
        }, true); // Use capturing phase to catch all clicks
    })();
</script>
</body>
</html>
